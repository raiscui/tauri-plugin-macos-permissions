# PhotoKit æƒé™åŠŸèƒ½æŠ€æœ¯æ ˆå†³ç­–

## æ ¸å¿ƒæŠ€æœ¯æ ˆ

### Rust ç”Ÿæ€ç³»ç»Ÿ
| æŠ€æœ¯ | é€‰æ‹© | ç‰ˆæœ¬ | ç†ç”± |
|------|------|------|------|
| è¯­è¨€ | Rust | 1.77.2+ | ç±»å‹å®‰å…¨ã€å†…å­˜å®‰å…¨ã€ä¸ç°æœ‰ä»£ç ä¸€è‡´ |
| äº’æ“ä½œ | objc2 | 0.6+ | æˆç†Ÿçš„ Objective-C ç»‘å®šï¼Œé¡¹ç›®å·²ä½¿ç”¨ |
| Foundation | objc2-foundation | 0.3+ | æä¾› NSString ç­‰åŸºç¡€ç±»å‹æ”¯æŒ |
| åºåˆ—åŒ– | serde | 1.x | JSON åºåˆ—åŒ–æ”¯æŒï¼ŒTauri æ ‡å‡† |
| é”™è¯¯å¤„ç† | thiserror | 2.x | ç»“æ„åŒ–é”™è¯¯å®šä¹‰ï¼Œé¡¹ç›®å·²ä½¿ç”¨ |
| å¼‚æ­¥è¿è¡Œæ—¶ | tokio | 1.x | å¼‚æ­¥æ“ä½œæ”¯æŒ (é€šè¿‡ Tauri) |

### macOS ç³»ç»Ÿæ¡†æ¶
| æ¡†æ¶ | æœ€ä½ç‰ˆæœ¬ | ç”¨é€” | ç†ç”± |
|------|----------|------|------|
| PhotoKit | macOS 10.15+ | ç…§ç‰‡åº“æƒé™ç®¡ç† | ç³»ç»Ÿæ ‡å‡†ç…§ç‰‡åº“è®¿é—®æ¡†æ¶ |
| Foundation | macOS 10.15+ | åŸºç¡€ Objective-C åŠŸèƒ½ | å­—ç¬¦ä¸²ã€é€šçŸ¥ç­‰åŸºç¡€åŠŸèƒ½ |
| Cocoa | macOS 10.15+ | åº”ç”¨ç¨‹åºæ¡†æ¶ | é€šçŸ¥ä¸­å¿ƒã€äº‹ä»¶å¤„ç† |

### å¼€å‘å·¥å…·
| å·¥å…· | ç‰ˆæœ¬ | ç”¨é€” | ç†ç”± |
|------|------|------|------|
| Cargo | 1.77+ | åŒ…ç®¡ç†å’Œæ„å»º | Rust æ ‡å‡†å·¥å…·é“¾ |
| rustc | 1.77.2+ | ç¼–è¯‘å™¨ | æ”¯æŒæœ€æ–°è¯­è¨€ç‰¹æ€§ |
| Xcode | 14+ | macOS å¼€å‘ç¯å¢ƒ | ç³»ç»Ÿæ¡†æ¶è®¿é—®å’Œè°ƒè¯• |

## æŠ€æœ¯å†³ç­–åˆ†æ

### 1. Objective-C äº’æ“ä½œæ–¹æ¡ˆ

#### é€‰æ‹©: objc2 crate
**ä¼˜åŠ¿**:
- ç±»å‹å®‰å…¨çš„ Objective-C ç»‘å®š
- è‡ªåŠ¨å†…å­˜ç®¡ç† (ARC æ”¯æŒ)
- ä¸ç°æœ‰é¡¹ç›®ä»£ç ä¸€è‡´
- æ´»è·ƒçš„ç¤¾åŒºç»´æŠ¤

**åŠ£åŠ¿**:
- å­¦ä¹ æ›²çº¿ç›¸å¯¹è¾ƒé™¡
- ç¼–è¯‘æ—¶é—´ç•¥é•¿

**æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯”**:
| æ–¹æ¡ˆ | ç±»å‹å®‰å…¨ | æ€§èƒ½ | ç»´æŠ¤æ€§ | å­¦ä¹ æˆæœ¬ |
|------|----------|------|--------|----------|
| objc2 | âœ… é«˜ | âœ… é«˜ | âœ… é«˜ | ğŸ”¶ ä¸­ç­‰ |
| ç›´æ¥ C ç»‘å®š | âŒ ä½ | âœ… é«˜ | âŒ ä½ | âœ… ä½ |
| cocoa crate | ğŸ”¶ ä¸­ç­‰ | âœ… é«˜ | ğŸ”¶ ä¸­ç­‰ | ğŸ”¶ ä¸­ç­‰ |

### 2. æƒé™çŠ¶æ€ç®¡ç†

#### é€‰æ‹©: åŸºäºæšä¸¾çš„çŠ¶æ€ç®¡ç†
**ä¼˜åŠ¿**:
- ç±»å‹å®‰å…¨
- ç¼–è¯‘æ—¶æ£€æŸ¥
- æ˜“äºåºåˆ—åŒ–
- ä¸ PhotoKit çŠ¶æ€ä¸€ä¸€å¯¹åº”

**å®ç°**:
```rust
#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]
pub enum PhotoKitAuthorizationStatus {
    NotDetermined = 0,
    Restricted = 1,
    Denied = 2,
    Authorized = 3,
    Limited = 4,
}
```

### 3. å¼‚æ­¥æ“ä½œå¤„ç†

#### é€‰æ‹©: Tauri çš„å¼‚æ­¥å‘½ä»¤æ¨¡å¼
**ä¼˜åŠ¿**:
- ä¸ Tauri æ¡†æ¶æ·±åº¦é›†æˆ
- è‡ªåŠ¨å¤„ç†è·¨çº¿ç¨‹é€šä¿¡
- æ”¯æŒ JavaScript Promise
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

**å®ç°æ¨¡å¼**:
```rust
#[command]
pub async fn request_photokit_permission(
    access_level: PhotoKitAccessLevel
) -> Result<PhotoKitAuthorizationStatus, String>
```

### 4. äº‹ä»¶ç³»ç»Ÿè®¾è®¡

#### é€‰æ‹©: åŸºäºå›è°ƒçš„äº‹ä»¶é€šçŸ¥
**ä¼˜åŠ¿**:
- å®æ—¶å“åº”æƒé™å˜åŒ–
- ä½å»¶è¿Ÿé€šçŸ¥
- æ”¯æŒå¤šä¸ªç›‘å¬å™¨
- å†…å­˜æ•ˆç‡é«˜

**æ¶æ„**:
- ä½¿ç”¨ NSNotificationCenter ç›‘å¬ç³»ç»Ÿäº‹ä»¶
- Rust ç«¯ç»´æŠ¤ç›‘å¬å™¨æ³¨å†Œè¡¨
- å¼‚æ­¥äº‹ä»¶åˆ†å‘æœºåˆ¶

## ä¾èµ–ç®¡ç†ç­–ç•¥

### Cargo.toml é…ç½®
```toml
[dependencies]
tauri = { version = "2" }
serde = { version = "1", features = ["derive"] }
thiserror = "2"

[target."cfg(target_os = \"macos\")".dependencies]
objc2 = "0.6"
objc2-foundation = "0.3"
```

### æ¡ä»¶ç¼–è¯‘ç­–ç•¥
```rust
#[cfg(target_os = "macos")]
mod photokit_impl;

#[cfg(not(target_os = "macos"))]
mod photokit_stub;
```

## æ€§èƒ½è€ƒè™‘

### å†…å­˜ç®¡ç†
- **Rust ç«¯**: ä½¿ç”¨æ‰€æœ‰æƒç³»ç»Ÿè‡ªåŠ¨ç®¡ç†
- **Objective-C ç«¯**: ä¾èµ– ARC è‡ªåŠ¨å¼•ç”¨è®¡æ•°
- **è·¨è¯­è¨€**: ä½¿ç”¨ objc2 çš„å®‰å…¨æŠ½è±¡

### å“åº”æ—¶é—´ä¼˜åŒ–
- **æƒé™æ£€æŸ¥**: åŒæ­¥è°ƒç”¨ï¼Œ< 50ms
- **æƒé™è¯·æ±‚**: å¼‚æ­¥è°ƒç”¨ï¼Œé¿å…é˜»å¡
- **çŠ¶æ€ç›‘å¬**: åŸºäºç³»ç»Ÿé€šçŸ¥ï¼Œå®æ—¶å“åº”

### å¹¶å‘å®‰å…¨
- ä½¿ç”¨ Rust çš„ç±»å‹ç³»ç»Ÿä¿è¯çº¿ç¨‹å®‰å…¨
- Objective-C è°ƒç”¨åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ
- çŠ¶æ€å˜åŒ–äº‹ä»¶å¼‚æ­¥åˆ†å‘

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- **æ¡†æ¶**: Rust å†…ç½®æµ‹è¯•æ¡†æ¶
- **è¦†ç›–**: æ‰€æœ‰å…¬å…± API å‡½æ•°
- **æ¨¡æ‹Ÿ**: ä½¿ç”¨æ¡ä»¶ç¼–è¯‘æä¾›æµ‹è¯•æ¡©

### é›†æˆæµ‹è¯•
- **ç¯å¢ƒ**: çœŸå® macOS ç¯å¢ƒ
- **æƒé™**: æµ‹è¯•æ‰€æœ‰æƒé™çº§åˆ«å’ŒçŠ¶æ€
- **è¾¹ç•Œ**: æµ‹è¯•é”™è¯¯æƒ…å†µå’Œè¾¹ç•Œæ¡ä»¶

### å¹³å°æµ‹è¯•
- **macOS**: å®Œæ•´åŠŸèƒ½æµ‹è¯•
- **å…¶ä»–å¹³å°**: ç¼–è¯‘å’Œç©ºå®ç°æµ‹è¯•
- **CI/CD**: è‡ªåŠ¨åŒ–è·¨å¹³å°æµ‹è¯•

## æ–‡æ¡£å’Œç»´æŠ¤

### ä»£ç æ–‡æ¡£
- **rustdoc**: å®Œæ•´çš„ API æ–‡æ¡£
- **ç¤ºä¾‹**: æ¯ä¸ªå…¬å…±å‡½æ•°éƒ½æœ‰ä½¿ç”¨ç¤ºä¾‹
- **æ³¨é‡Š**: å…³é”®ç®—æ³•å’Œè®¾è®¡å†³ç­–è¯´æ˜

### ç”¨æˆ·æ–‡æ¡£
- **README**: å¿«é€Ÿå¼€å§‹æŒ‡å—
- **ç¤ºä¾‹**: å®Œæ•´çš„é›†æˆç¤ºä¾‹
- **æ•…éšœæ’é™¤**: å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### ç»´æŠ¤ç­–ç•¥
- **ç‰ˆæœ¬æ§åˆ¶**: è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶
- **å‘åå…¼å®¹**: API ç¨³å®šæ€§ä¿è¯
- **æ›´æ–°ç­–ç•¥**: è·Ÿéš macOS å’Œ Tauri ç‰ˆæœ¬æ›´æ–°

## é£é™©è¯„ä¼°å’Œç¼“è§£

### æŠ€æœ¯é£é™©
| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| PhotoKit API å˜æ›´ | ä½ | é«˜ | ç‰ˆæœ¬æ£€æŸ¥ã€å…¼å®¹æ€§å±‚ |
| objc2 å…¼å®¹æ€§é—®é¢˜ | ä½ | ä¸­ | å……åˆ†æµ‹è¯•ã€å¤‡é€‰æ–¹æ¡ˆ |
| æ€§èƒ½é—®é¢˜ | ä¸­ | ä¸­ | æ€§èƒ½æµ‹è¯•ã€ä¼˜åŒ–ç­–ç•¥ |
| å†…å­˜æ³„æ¼ | ä½ | ä¸­ | å†…å­˜æµ‹è¯•ã€ä»£ç å®¡æŸ¥ |

### ç»´æŠ¤é£é™©
| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| ä¾èµ–è¿‡æ—¶ | ä¸­ | ä½ | å®šæœŸæ›´æ–°ã€ä¾èµ–ç›‘æ§ |
| æ–‡æ¡£è¿‡æ—¶ | ä¸­ | ä¸­ | è‡ªåŠ¨åŒ–æ–‡æ¡£ç”Ÿæˆ |
| æµ‹è¯•è¦†ç›–ä¸è¶³ | ä½ | é«˜ | ä»£ç è¦†ç›–ç‡ç›‘æ§ |

## æ€»ç»“

é€‰æ‹©çš„æŠ€æœ¯æ ˆåŸºäºä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š
1. **ä¸€è‡´æ€§**: ä¸ç°æœ‰é¡¹ç›®æŠ€æœ¯æ ˆä¿æŒä¸€è‡´
2. **å®‰å…¨æ€§**: ä¼˜å…ˆé€‰æ‹©ç±»å‹å®‰å…¨å’Œå†…å­˜å®‰å…¨çš„æ–¹æ¡ˆ
3. **æ€§èƒ½**: ç¡®ä¿æ»¡è¶³å“åº”æ—¶é—´å’Œèµ„æºä½¿ç”¨è¦æ±‚
4. **å¯ç»´æŠ¤æ€§**: é€‰æ‹©æœ‰è‰¯å¥½ç¤¾åŒºæ”¯æŒçš„æˆç†ŸæŠ€æœ¯
5. **æ‰©å±•æ€§**: ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•é¢„ç•™ç©ºé—´

è¿™ä¸ªæŠ€æœ¯æ ˆèƒ½å¤Ÿæ»¡è¶³ PhotoKit æƒé™åŠŸèƒ½çš„æ‰€æœ‰éœ€æ±‚ï¼ŒåŒæ—¶ä¿æŒä¸ç°æœ‰ä»£ç çš„ä¸€è‡´æ€§å’Œé«˜è´¨é‡çš„ç”¨æˆ·ä½“éªŒã€‚
